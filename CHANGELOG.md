# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [v0.21.0] - 2023-05-09

### Changed

* Force uniqueness of relationship names in `psql` driver

### Fixed

* Fix panic when attaching associated relationships
* Make getting a random integer for preloading thread-safe

## [v0.20.6] - 2023-04-25

### Fixed

* Check all members when loading relationships

## [v0.20.5] - 2023-04-14

### Fixed

* Fix panic in Insert/Attach Relationship loop

## [v0.20.4] - 2023-04-07

### Fixed

* Replace `huandu/go-clone` with `qdm12/reprint`

## [v0.20.3] - 2023-04-06

### Fixed

* Fix cloning bug by replacing `jinzhu/copier` with `huandu/go-clone`

## [v0.20.2] - 2023-04-05

### Fixed

* Account for windows when calculating models module path

## [v0.20.1] - 2023-04-04

### Fixed

* Update the generated code to use `github.com/gofrs/uuid/v5`
* Fix bug where auto-increment columns were marked as generated in the SQLite driver

## [v0.20.0] - 2023-04-03

### Added

* Add the `PreloadWhere` preload mod to filter what relation should be preloaded.
* `ViewQuery` now embeds `bob.BaseQuery` giving it additional methods like `Apply` and `Build`
* Add plugin support. Currently 3 plugin hooks are provided. `PlugState`, `PlugDBInfo` and `PlugTemplateData`.

### Changed

* Make `View.Name()` return a dialect-specific expression
* Improve `Debug` helpers.
  * `Debug` writes query output to stdout
  * `DebugToWriter` writes the query output to any `io.Writer` with a fallback to stdout.
  * `DebugToPrinter` prints the query with a given `bob.DebugPrinter`. Also falls back to stdout.
* Rename `OnlyColumns` to `PreloadOnly` and `ExceptColumns` to `PreloadExcept` to be more consistent with the newly added `PreloadWhere`.
* `JoinChain.On` now takes Expressions instead of `any`.
* `JoinChain.Using` now takes strings instead of `any`.
* Export `gen.TemplateData`

### Removed

* Remove `ILIKE` operator from MySQL since it is not supported.
* Removed `Destination()` method in driver interface.
* Removed `PackageName()` method in driver interface.

### Fixed

* Account for possible clashes between column and relationship alias
* Make `Preload` mods work the same way as other query mods
* Avoid overwriting manually flipped relationships.
* Account for potentially null relationship in Load methods

## [v0.19.1] - 2023-03-21

### Fixed

* Fix `On` method for JoinChain in `mysql` and `sqlite`

## [v0.19.0] - 2023-03-19

### Added

* Add `LIKE` and `ILIKE` operators
* Print generated files
* Add `no_reverse` option for user-configured relationships

### Changed

* Move common parts of loading to shared internal package

### Fixed

* Fix generated joins for multi-sided relationships

## [v0.18.2] - 2023-03-18

### Fixed

* Account for relationships with tables that do not have a primary key in models and factories
* Properly extract preloaders nested in `mods.QueryMods`
* Fix bug in preloading with multiple sides
* Fix issue with multi-sided relationships that include views

## [v0.18.1] - 2023-03-16

### Fixed

* Make self-referencing foreign keys work
* Tweak factory types to make collisions even less likely

## [v0.18.0] - 2023-03-12

### Changed

* Comparison methods now require an expression (`bob.Expression`)

### Removed

* No more `X` builder start function
* No more `P` builder method

## [v0.17.3] - 2023-03-11

### Fixed

* Fix bug with args in table updates
* Fix some typos in documentation (thanks @leonardtan13)

## [v0.17.2] - 2023-03-09

### Fixed

* Fix a bug when multiple multi-column foreign keys exist
* Multiple internal changes to the generator to make it easier to write a custom entrypoint
* More robust testing of code generation
* json, yaml and toml struct tags are no longer autogenerated but can still be added though configuration

## [v0.17.1] - 2023-03-08

### Fixed

* Fixed a bug in sqlite `join_helper` block which causes an error during code generation

## [v0.17.0] - 2023-03-07

### Added

* Now, Bob will generate join mods for model relationships such as:

    ```go
    models.SelectJoin(ctx).Users.InnerJoin.Posts
    ```

### Fixed

* Fixed an issue with ON DUPLICATE KEY UPDATE (#14)

## [v0.16.0] - 2023-03-06

### Added

* Add a code generation driver for Atlas
* Add JOIN mods for MySQL update queries

### Changed

* Change how the `um.Set` update mod works to allow more query building

### Fixed

* Fix upserts in all 3 dialects to ignore the update columns when generating the insert column set
* Return early in InsertMany/UpsertMany/UpdateMany/DeleteMany if 0 rows to act on
* Report error if non-default codegen config file is misssing
